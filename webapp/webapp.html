<html>
<head>
<meta charset="utf-8">
<meta name="author" content="Marcin Ulikowski">
<meta name="description" content="Find lookalike phishing domains that adversaries can use to attack you">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>dnspermutator | phishing domain scanner</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<link rel="icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAABgUExURS2dzv///6TH4f7+/+7z+I272wxOgyBwofb5++bq70Whz3Ww1tPi77DM493n8CyZyvn7/JyounuKpBx3qczd61qm0QtWixFfkhZqnDmfz57C3WCSuLvI12OZv4yxz7vBzYWBO0AAAAB6SURBVBjTXc2HCsMwDARQXSSv2M6enf//l21xk9o9EIgHJxH+QlNVJJDslKUWQkzrPntVxQCCfYxmWxc9PB1/brzH9Vov62bGu0sQfZ1qnhM0x8nmW4FKHy44QK7G3GzHJ0AGrXuLH7Bq27nLAIFoQg6sFBcAEZRw5gWepARYlUogjwAAAABJRU5ErkJggg==">
<style>
html {
	overflow-y: scroll;
}
body {
	font-family: -apple-system,Segoe UI,Ubuntu,Helvetica,Arial;
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	color: #353739;
	margin: 0;
	min-height: 100vh;
}
div#container {
	position: relative;
	width: 70%;
	margin: 2em auto 0 auto;
	background: rgba(255, 255, 255, 0.95);
	border-radius: 20px;
	padding: 2em;
	box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
	backdrop-filter: blur(10px);
}
table {
	border-collapse: collapse;
	width: 100%;
	margin: 3em 0;
	table-layout: fixed;
	border-radius: 10px;
	overflow: hidden;
	background: white;
	box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}
tr {
	border-bottom: 1px solid #f0f0f0;
	transition: background-color 0.3s ease;
}
tr:hover {
	background-color: #f8f9fa;
}
th {
	padding: 15px 10px;
	text-align: left;
	font-weight: 600;
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	color: white;
	text-transform: uppercase;
	font-size: 0.8em;
	letter-spacing: 1px;
}
td {
	padding: 15px 10px;
	vertical-align: top;
	word-wrap: break-word;
}
header {
	text-align: center;
}
header h1 {
	margin: 0;
}
header p {
	color: #667eea;
	font: bold 150% Tahoma,Verdana;
	margin: 0;
	text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
}
div#searchbox {
	display: flex;
	margin: 4em auto 0 auto;
	position: relative;
}
input#url {
	font-size: 1.1em;
	height: 3.5em;
	border: 2px solid transparent;
	border-radius: 15px 0 0 15px;
	padding-left: 1em;
	width: 80%;
	outline: none;
	background: white;
	box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
	transition: all 0.3s ease;
}
input#url:focus {
	border-color: #667eea;
	box-shadow: 0 5px 25px rgba(102, 126, 234, 0.3);
}
button#scan {
	color: white;
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	border: 0;
	border-radius: 0 15px 15px 0;
	height: 3.5em;
	font-size: 1.1em;
	font-weight: 600;
	flex-grow: 1;
	outline: none;
	cursor: pointer;
	transition: all 0.3s ease;
	box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}
button#scan:hover {
	transform: translateY(-2px);
	box-shadow: 0 7px 20px rgba(0, 0, 0, 0.3);
}
sup {
	color: #777;
}

/* Enhanced Progress Bar */
.progress-container {
	margin: 20px 0;
	background: #f0f0f0;
	border-radius: 25px;
	overflow: hidden;
	box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}
progress {
	-webkit-appearance: none;
	-moz-appearance: none;
	height: 15px;
	width: 100%;
	background-color: transparent;
	border: 0;
	border-radius: 25px;
}
progress::-webkit-progress-bar {
	background-color: #f0f0f0;
	border-radius: 25px;
}
progress::-webkit-progress-value {
	background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
	border-radius: 25px;
	transition: width 0.3s ease;
}
progress::-moz-progress-bar {
	background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
	border-radius: 25px;
}

/* Loading Animation */
.loading-container {
	display: none;
	text-align: center;
	margin: 30px 0;
}
.spinner {
	display: inline-block;
	width: 60px;
	height: 60px;
	border: 4px solid rgba(102, 126, 234, 0.3);
	border-radius: 50%;
	border-top-color: #667eea;
	animation: spin 1s ease-in-out infinite;
	margin-bottom: 20px;
}
@keyframes spin {
	to { transform: rotate(360deg); }
}
.pulse-dots {
	display: inline-flex;
	gap: 8px;
	margin-left: 10px;
}
.pulse-dot {
	width: 8px;
	height: 8px;
	border-radius: 50%;
	background: #667eea;
	animation: pulse 1.4s ease-in-out infinite both;
}
.pulse-dot:nth-child(1) { animation-delay: -0.32s; }
.pulse-dot:nth-child(2) { animation-delay: -0.16s; }
.pulse-dot:nth-child(3) { animation-delay: 0; }
@keyframes pulse {
	0%, 80%, 100% { 
		transform: scale(0.8);
		opacity: 0.5;
	}
	40% { 
		transform: scale(1);
		opacity: 1;
	}
}

/* Scan Statistics */
.stat-item {
	background: rgba(255, 255, 255, 0.9);
	border-radius: 10px;
	padding: 10px 15px;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	min-width: 60px;
}
.stat-number {
	font-size: 1.5em;
	font-weight: bold;
	color: #667eea;
}
.stat-label {
	font-size: 0.8em;
	color: #888;
	margin-top: 2px;
}

/* Progress Chart */
.chart-container {
	background: rgba(255, 255, 255, 0.9);
	border-radius: 15px;
	padding: 15px;
	box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
	max-width: 300px;
	margin: 0 auto;
}
.chart-bar {
	position: relative;
	height: 30px;
	background: #f0f0f0;
	border-radius: 15px;
	overflow: hidden;
	box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
}
.chart-fill {
	height: 100%;
	background: linear-gradient(90deg, #56ab2f 0%, #a8e6cf 50%, #667eea 100%);
	border-radius: 15px;
	width: 0%;
	transition: width 0.5s ease;
	position: relative;
}
.chart-fill::after {
	content: '';
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	bottom: 0;
	background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.3) 50%, transparent 100%);
	animation: shimmer 2s infinite;
}
@keyframes shimmer {
	0% { transform: translateX(-100%); }
	100% { transform: translateX(100%); }
}
.chart-text {
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	font-weight: bold;
	color: #333;
	font-size: 0.9em;
	text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
}

/* Current scanning domain */
#current-scan {
	background: rgba(255, 255, 255, 0.9);
	border-radius: 20px;
	padding: 8px 15px;
	display: inline-block;
	box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
	font-family: monospace;
	max-width: 80%;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}

/* Interactive Dashboard Styles */
#dashboard {
	margin: 30px 0;
	animation: fadeInUp 0.6s ease-out;
}

.dashboard-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin-bottom: 30px;
}

.dashboard-header h2 {
	margin: 0;
	color: #667eea;
	font-size: 1.8em;
}

.dashboard-controls {
	display: flex;
	gap: 10px;
}

.control-btn {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	color: white;
	border: none;
	padding: 10px 15px;
	border-radius: 25px;
	cursor: pointer;
	font-size: 0.9em;
	transition: all 0.3s ease;
	box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.control-btn:hover {
	transform: translateY(-2px);
	box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
}

/* Metrics Grid */
.metrics-grid {
	display: grid;
	grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
	gap: 20px;
	margin-bottom: 30px;
}

.metric-card {
	background: white;
	border-radius: 20px;
	padding: 25px;
	box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
	transition: all 0.3s ease;
	position: relative;
	overflow: hidden;
}

.metric-card::before {
	content: '';
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	height: 4px;
	background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
}

.metric-card.total::before { background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); }
.metric-card.processed::before { background: linear-gradient(90deg, #56ab2f 0%, #a8e6cf 100%); }
.metric-card.found::before { background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%); }
.metric-card.threats::before { background: linear-gradient(90deg, #ff416c 0%, #ff4b2b 100%); }

.metric-card:hover {
	transform: translateY(-5px);
	box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
}

.metric-card {
	display: flex;
	align-items: center;
	gap: 20px;
}

.metric-icon {
	font-size: 2.5em;
	opacity: 0.8;
}

.metric-content {
	flex: 1;
}

.metric-number {
	font-size: 2.2em;
	font-weight: bold;
	color: #667eea;
	line-height: 1;
	animation: countUp 0.8s ease-out;
}

.metric-label {
	color: #888;
	font-size: 0.9em;
	margin: 5px 0;
	text-transform: uppercase;
	letter-spacing: 1px;
}

.metric-trend {
	color: #56ab2f;
	font-size: 0.8em;
	font-weight: 500;
}

@keyframes countUp {
	from { transform: scale(0.5); opacity: 0; }
	to { transform: scale(1); opacity: 1; }
}

/* Activity Feed */
.activity-section {
	margin: 30px 0;
}

.activity-section h3 {
	color: #667eea;
	margin-bottom: 15px;
}

.activity-feed {
	background: rgba(255, 255, 255, 0.9);
	border-radius: 15px;
	padding: 20px;
	max-height: 200px;
	overflow-y: auto;
	box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
}

.activity-item {
	display: flex;
	align-items: center;
	gap: 15px;
	padding: 8px 0;
	border-bottom: 1px solid #f0f0f0;
	animation: slideInLeft 0.3s ease;
}

.activity-item:last-child {
	border-bottom: none;
}

.timestamp {
	color: #888;
	font-family: monospace;
	font-size: 0.8em;
	min-width: 80px;
}

.activity-text {
	color: #333;
	font-size: 0.9em;
}

@keyframes slideInLeft {
	from { transform: translateX(-30px); opacity: 0; }
	to { transform: translateX(0); opacity: 1; }
}

/* Charts Grid */
.charts-grid {
	display: grid;
	grid-template-columns: 2fr 1fr;
	gap: 30px;
	margin: 30px 0;
}

.chart-card {
	background: white;
	border-radius: 20px;
	padding: 25px;
	box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
}

.chart-card h4 {
	margin: 0 0 20px 0;
	color: #667eea;
	font-size: 1.2em;
}

/* Donut Chart */
.donut-chart {
	position: relative;
	display: flex;
	justify-content: center;
	align-items: center;
}

.donut-center {
	position: absolute;
	text-align: center;
	z-index: 2;
}

.donut-percentage {
	font-size: 2em;
	font-weight: bold;
	color: #667eea;
	line-height: 1;
}

.donut-label {
	color: #888;
	font-size: 0.8em;
	text-transform: uppercase;
	letter-spacing: 1px;
}

.donut-svg {
	transform: rotate(-90deg);
}

#donut-progress {
	transition: stroke-dashoffset 0.5s ease;
	stroke-linecap: round;
}

/* Timeline Chart */
.timeline-chart {
	height: 200px;
	position: relative;
	display: flex;
	align-items: center;
	justify-content: center;
}

#progressChart {
	background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
	border-radius: 10px;
}

/* Enhanced Animations */
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideIn {
	from { transform: translateY(-20px); opacity: 0; }
	to { transform: translateY(0); opacity: 1; }
}

@keyframes pulse-glow {
	0%, 100% {
		box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
	}
	50% {
		box-shadow: 0 0 30px rgba(102, 126, 234, 0.6);
	}
}

.metric-card.active {
	animation: pulse-glow 2s infinite;
}

/* Enhanced Results Section */
.results-header {
	display: flex;
	justify-content: space-between;
	align-items: center;
	margin: 30px 0 20px 0;
	padding: 20px;
	background: rgba(255, 255, 255, 0.9);
	border-radius: 15px;
	box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
}

.results-header h3 {
	margin: 0;
	color: #667eea;
	font-size: 1.5em;
}

.results-controls {
	display: flex;
	gap: 15px;
	align-items: center;
}

.filter-input, .sort-select {
	padding: 10px 15px;
	border: 2px solid transparent;
	border-radius: 25px;
	background: white;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	outline: none;
	transition: all 0.3s ease;
}

.filter-input:focus, .sort-select:focus {
	border-color: #667eea;
	box-shadow: 0 2px 15px rgba(102, 126, 234, 0.3);
}

.view-btn {
	background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
	color: white;
	border: none;
	padding: 10px 15px;
	border-radius: 25px;
	cursor: pointer;
	transition: all 0.3s ease;
}

/* Domain Cards Grid */
.domain-cards-grid {
	display: grid;
	grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
	gap: 20px;
	margin: 20px 0;
}

.domain-card {
	background: white;
	border-radius: 15px;
	padding: 20px;
	box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
	transition: all 0.3s ease;
	position: relative;
	overflow: hidden;
	animation: slideInUp 0.3s ease;
}

.domain-card::before {
	content: '';
	position: absolute;
	top: 0;
	left: 0;
	right: 0;
	height: 4px;
}

.domain-card.risk-low::before { background: linear-gradient(90deg, #56ab2f 0%, #a8e6cf 100%); }
.domain-card.risk-medium::before { background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%); }
.domain-card.risk-high::before { background: linear-gradient(90deg, #ff416c 0%, #ff4b2b 100%); }

.domain-card:hover {
	transform: translateY(-5px);
	box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
}

.domain-header {
	display: flex;
	justify-content: space-between;
	align-items: flex-start;
	margin-bottom: 15px;
}

.domain-name {
	font-size: 1.2em;
	font-weight: bold;
	color: #333;
	margin: 0;
	word-break: break-all;
}

.domain-actions {
	display: flex;
	gap: 8px;
}

.action-btn {
	background: none;
	border: none;
	font-size: 1.2em;
	cursor: pointer;
	padding: 5px;
	border-radius: 50%;
	transition: all 0.2s ease;
}

.action-btn:hover {
	background: rgba(102, 126, 234, 0.1);
	transform: scale(1.2);
}

.domain-details {
	display: grid;
	grid-template-columns: 1fr 1fr;
	gap: 15px;
	margin: 15px 0;
}

.detail-item {
	display: flex;
	flex-direction: column;
	gap: 5px;
}

.detail-label {
	font-size: 0.8em;
	color: #888;
	text-transform: uppercase;
	letter-spacing: 1px;
}

.detail-value {
	font-weight: 500;
	color: #333;
	font-family: monospace;
	font-size: 0.9em;
}

.fuzzer-tag {
	background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
	color: #667eea;
	padding: 4px 8px;
	border-radius: 15px;
	font-size: 0.7em;
	text-transform: uppercase;
	letter-spacing: 1px;
	display: inline-block;
	margin-top: 10px;
}

.risk-indicator {
	position: absolute;
	top: 15px;
	right: 15px;
	width: 12px;
	height: 12px;
	border-radius: 50%;
	animation: pulse 2s infinite;
}

.risk-low { background: #56ab2f; }
.risk-medium { background: #f5576c; }
.risk-high { background: #ff4b2b; }

@keyframes slideInUp {
	from {
		opacity: 0;
		transform: translateY(20px);
	}
	to {
		opacity: 1;
		transform: translateY(0);
	}
}

/* Domain Card Animations */
.domain-card.new {
	animation: bounceIn 0.6s ease;
}

@keyframes bounceIn {
	0% {
		opacity: 0;
		transform: scale(0.3);
	}
	50% {
		opacity: 1;
		transform: scale(1.05);
	}
	70% {
		transform: scale(0.9);
	}
	100% {
		opacity: 1;
		transform: scale(1);
	}
}

span#status {
	display: block;
	text-align: center;
	font-size: 0.9em;
	margin-top: 15px;
	padding: 10px;
	background: rgba(255, 255, 255, 0.8);
	border-radius: 10px;
	box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
}
a {
	color: #667eea;
	text-decoration: underline;
	text-decoration-skip: ink;
	transition: color 0.3s ease;
}
a:hover {
	color: #764ba2;
	text-decoration: none;
}
a#link {
	color: inherit;
	text-decoration: none;
	transition: transform 0.2s ease;
}
a#link:hover {
	transform: scale(1.2);
}
span#source {
	position: fixed;
	right: 1em;
	bottom: 1em;
	background: rgba(255, 255, 255, 0.9);
	padding: 10px 15px;
	border-radius: 25px;
	box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
	backdrop-filter: blur(10px);
}

/* Success/Error Messages */
.message {
	padding: 15px 20px;
	border-radius: 10px;
	margin: 20px 0;
	font-weight: 500;
	text-align: center;
	animation: slideIn 0.3s ease;
}
.message.success {
	background: linear-gradient(135deg, #56ab2f 0%, #a8e6cf 100%);
	color: white;
}
.message.error {
	background: linear-gradient(135deg, #ff416c 0%, #ff4b2b 100%);
	color: white;
}
@keyframes slideIn {
	from { transform: translateY(-20px); opacity: 0; }
	to { transform: translateY(0); opacity: 1; }
}

/* Domain Cards */
.domain-card {
	background: white;
	border-radius: 15px;
	padding: 20px;
	margin: 15px 0;
	box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
	transition: all 0.3s ease;
	border-left: 5px solid #667eea;
}
.domain-card:hover {
	transform: translateY(-5px);
	box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
}

/* Modal Styles */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
    animation: fadeIn 0.3s;
}

.modal-content {
    position: relative;
    background: white;
    margin: 5% auto;
    padding: 0;
    width: 80%;
    max-width: 800px;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
    animation: slideInDown 0.4s;
}

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px 20px 10px 20px;
    border-bottom: 1px solid #f0f0f0;
}

.modal-header h2 {
    margin: 0;
    color: #667eea;
}

.modal-body {
    padding: 20px;
    max-height: 70vh;
    overflow-y: auto;
}

.close {
    color: #aaa;
    font-size: 28px;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.3s;
}

.close:hover {
    color: #667eea;
}

.history-item {
    background: white;
    border-radius: 15px;
    padding: 15px;
    margin-bottom: 15px;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    cursor: pointer;
    border-left: 4px solid #667eea;
}

.history-item:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

.history-domain {
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 5px;
}

.history-date {
    color: #888;
    font-size: 0.8em;
}

.history-stats {
    display: flex;
    gap: 15px;
    margin-top: 10px;
}

.history-stat {
    background: #f8f9fa;
    border-radius: 20px;
    padding: 5px 12px;
    font-size: 0.8em;
    color: #667eea;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideInDown {
    from { transform: translateY(-30px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}

@media (max-width: 800px) {
	body, table, span {
		font-size: 75%;
	}	pip install -r webapp/requirements.txt	pip install -r webapp/requirements.txt	pip install -r webapp/requirements.txt	pip install -r webapp/requirements.txt	pip install -r webapp/requirements.txt	pip install -r webapp/requirements.txt	pip install -r webapp/requirements.txt	pip install -r webapp/requirements.txt
	div#container {
		width: 95%;
		margin: 1em auto;
		padding: 1em;
	}
	img#logo {
		width: 80%;
	}
	div#searchbox {
		flex-direction: column;
	}
	input#url, button#scan {
		border-radius: 15px;
		margin: 5px 0;
	}
	#scan-stats {
		flex-direction: column;
		gap: 10px !important;
	}
	.stat-item {
		margin: 0 auto;
	}
	.chart-container {
		max-width: 250px;
	}
	#current-scan {
		max-width: 95%;
		font-size: 0.8em;
	}
	.metrics-grid {
		grid-template-columns: 1fr;
	}
	.charts-grid {
		grid-template-columns: 1fr;
	}
	.results-header {
		flex-direction: column;
		gap: 15px;
	}
	.results-controls {
		flex-wrap: wrap;
		justify-content: center;
	}
	.domain-cards-grid {
		grid-template-columns: 1fr;
	}
	.dashboard-header {
		flex-direction: column;
		gap: 15px;
	}
    .modal-content {
        width: 95%;
        margin: 10% auto;
    }
}
</style>
</head>
<body>
	<div id="container">
		<div>
			<header>
				<h1 style="font-size: 32px; color: #667eea; text-shadow: 2px 2px 4px rgba(0,0,0,0.1);">Dns-permutator</h1>
				<!-- <p>phishing domain scanner</p> -->
			</header>
			<div id="searchbox">
				<input type="hidden" id="sid">
				<input type="text" id="url" placeholder="üîç Enter domain name (e.g., google.com)" autofocus>
				<button id="scan">üîç Scan</button>
				<button id="history">üìä History</button>
			</div>
            
            <!-- History Modal -->
            <div id="history-modal" class="modal" style="display:none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>üìä Scan History</h2>
                        <span class="close">&times;</span>
                    </div>
                    <div class="modal-body">
                        <div id="history-list">
                            <p>Loading history...</p>
                        </div>
                    </div>
                </div>
            </div>
			
			<!-- Interactive Dashboard -->
			<div id="dashboard" style="display: none;">
				<div class="dashboard-header">
					<h2>üéØ Scan Dashboard</h2>
					<div class="dashboard-controls">
						<button id="pause-btn" class="control-btn">‚è∏Ô∏è Pause</button>
						<button id="export-btn" class="control-btn">üìä Export</button>
						<button id="filter-btn" class="control-btn">üîç Filter</button>
					</div>
				</div>
				
				<div class="metrics-grid">
					<div class="metric-card total">
						<div class="metric-icon">üéØ</div>
						<div class="metric-content">
							<div class="metric-number" id="total-domains">0</div>
							<div class="metric-label">Total Domains</div>
							<div class="metric-trend">‚ÜóÔ∏è Generating...</div>
						</div>
					</div>
					
					<div class="metric-card processed">
						<div class="metric-icon">‚ö°</div>
						<div class="metric-content">
							<div class="metric-number" id="processed-domains">0</div>
							<div class="metric-label">Processed</div>
							<div class="metric-trend" id="processing-rate">0 domains/sec</div>
						</div>
					</div>
					
					<div class="metric-card found">
						<div class="metric-icon">üéâ</div>
						<div class="metric-content">
							<div class="metric-number" id="found-domains">0</div>
							<div class="metric-label">Found Active</div>
							<div class="metric-trend" id="success-rate">0% success rate</div>
						</div>
					</div>
					
					<div class="metric-card threats">
						<div class="metric-icon">‚ö†Ô∏è</div>
						<div class="metric-content">
							<div class="metric-number" id="threat-level">LOW</div>
							<div class="metric-label">Threat Level</div>
							<div class="metric-trend" id="threat-desc">Monitoring...</div>
						</div>
					</div>
				</div>
				
				<!-- Real-time Activity Feed -->
				<div class="activity-section">
					<h3>üî¥ Live Activity Feed</h3>
					<div id="activity-feed" class="activity-feed">
						<div class="activity-item">
							<span class="timestamp">00:00:00</span>
							<span class="activity-text">üöÄ Scan initialized</span>
						</div>
					</div>
				</div>
				
				<!-- Interactive Charts -->
				<div class="charts-grid">
					<div class="chart-card">
						<h4>üìà Progress Timeline</h4>
						<div class="timeline-chart">
							<canvas id="progressChart" width="400" height="200"></canvas>
						</div>
					</div>
					
					<div class="chart-card">
						<h4>üç© Domain Distribution</h4>
						<div class="donut-chart">
							<div class="donut-center">
								<div class="donut-percentage" id="completion-percentage">0%</div>
								<div class="donut-label">Complete</div>
							</div>
							<svg class="donut-svg" width="180" height="180">
								<circle cx="90" cy="90" r="70" fill="none" stroke="#f0f0f0" stroke-width="20"/>
								<circle id="donut-progress" cx="90" cy="90" r="70" fill="none" stroke="#667eea" stroke-width="20" 
									stroke-dasharray="439.82" stroke-dashoffset="439.82" transform="rotate(-90 90 90)"/>
							</svg>
						</div>
					</div>
				</div>
			</div>
			
			<div class="progress-container">
				<progress id="progress" value="0"></progress>
			</div>
			<div class="loading-container" id="loading">
				<div class="spinner"></div>
				<div style="font-size: 1.1em; color: #667eea; font-weight: 500;">
					Scanning domains<span class="pulse-dots">
						<span class="pulse-dot"></span>
						<span class="pulse-dot"></span>
						<span class="pulse-dot"></span>
					</span>
				</div>
				<div id="current-scan" style="margin-top: 15px; font-size: 0.9em; color: #888;">
					Preparing scan...
				</div>
				<div id="scan-stats" style="margin-top: 10px; display: flex; justify-content: center; gap: 20px; font-size: 0.8em;">
					<div class="stat-item">
						<div class="stat-number" id="processed-count">0</div>
						<div class="stat-label">Processed</div>
					</div>
					<div class="stat-item">
						<div class="stat-number" id="found-count">0</div>
						<div class="stat-label">Found</div>
					</div>
					<div class="stat-item">
						<div class="stat-number" id="total-count">0</div>
						<div class="stat-label">Total</div>
					</div>
				</div>
				<div id="progress-chart" style="margin-top: 20px;">
					<div class="chart-container">
						<div class="chart-bar">
							<div class="chart-fill" id="chart-fill"></div>
							<div class="chart-text" id="chart-percentage">0%</div>
						</div>
					</div>
				</div>
			</div>
			<span id="status"></span>
		</div>
		
		<!-- Enhanced Results Section -->
		<div id="results-section" style="display: none;">
			<div class="results-header">
				<h3>üéØ Discovered Domains</h3>
				<div class="results-controls">
					<input type="text" id="search-filter" placeholder="üîç Filter domains..." class="filter-input">
					<select id="sort-select" class="sort-select">
						<option value="name">Sort by Name</option>
						<option value="risk">Sort by Risk</option>
						<option value="similarity">Sort by Similarity</option>
					</select>
					<button id="view-toggle" class="view-btn">üìã List View</button>
				</div>
			</div>
			<div id="domain-cards-container" class="domain-cards-grid">
				<!-- Domain cards will be populated here -->
			</div>
		</div>
		
		<table id="data"></table>
	</div>
	<span id="source">[<a href="#">dnspermutator</a>]</span>
</body>
<script>
window.onload = function() {
	// Hide loading animation initially
	$('#loading').hide();
	$('#progress').hide();
	$('#dashboard').hide();
	$('#results-section').hide();
	
	// Initialize dashboard controls
	initializeDashboard();
	
	if (window.location.hash) {
		$('#sid').val(window.location.hash.substring(1));
		fetchDomains();
		$('#dashboard').show();
		$('#results-section').show();
	}
}

// Dashboard variables
let scanStartTime = null;
let lastProcessedCount = 0;
let processingRate = 0;
let activityFeedItems = [];
let discoveredDomains = [];
let chartData = [];
let animationFrameId = null;

// Initialize interactive dashboard
function initializeDashboard() {
	// Control buttons
	$('#pause-btn').click(function() {
		if ($(this).text().includes('Pause')) {
			$(this).html('‚ñ∂Ô∏è Resume');
			// Pause logic would go here
		} else {
			$(this).html('‚è∏Ô∏è Pause');
			// Resume logic would go here
		}
	});
	
	$('#export-btn').click(function() {
		exportResults();
	});
	
	$('#filter-btn').click(function() {
		toggleFilters();
	});
	
	// Results section controls
	$('#search-filter').on('input', function() {
		filterDomains();
	});
	
	$('#sort-select').change(function() {
		sortDomains();
	});
	
	$('#view-toggle').click(function() {
		toggleView();
	});
	
	// Initialize charts
	initializeCharts();
}

// Activity feed management
function addActivityItem(text, type = 'info') {
	const timestamp = new Date().toLocaleTimeString();
	const item = {
		timestamp: timestamp,
		text: text,
		type: type
	};
	
	activityFeedItems.unshift(item);
	if (activityFeedItems.length > 20) {
		activityFeedItems.pop();
	}
	
	updateActivityFeed();
}

function updateActivityFeed() {
	const feed = $('#activity-feed');
	feed.empty();
	
	activityFeedItems.forEach(item => {
		const icon = item.type === 'success' ? '‚úÖ' : 
		            item.type === 'warning' ? '‚ö†Ô∏è' : 
		            item.type === 'error' ? '‚ùå' : 'üîµ';
		
		feed.append(`
			<div class="activity-item">
				<span class="timestamp">${item.timestamp}</span>
				<span class="activity-text">${icon} ${item.text}</span>
			</div>
		`);
	});
}

// Animated counters
function animateCounter(element, target, duration = 1000) {
	const start = parseInt($(element).text()) || 0;
	const increment = (target - start) / (duration / 16);
	let current = start;
	
	const timer = setInterval(() => {
		current += increment;
		if ((increment > 0 && current >= target) || (increment < 0 && current <= target)) {
			current = target;
			clearInterval(timer);
		}
		$(element).text(Math.floor(current));
	}, 16);
}

// Threat level calculation
function calculateThreatLevel(foundCount, totalCount) {
	if (totalCount === 0) return 'UNKNOWN';
	
	const percentage = (foundCount / totalCount) * 100;
	
	if (percentage < 5) return 'LOW';
	if (percentage < 15) return 'MEDIUM';
	if (percentage < 30) return 'HIGH';
	return 'CRITICAL';
}

// Export functionality
function exportResults() {
	const data = {
		timestamp: new Date().toISOString(),
		domain: $('#url').val(),
		results: discoveredDomains,
		summary: {
			total: parseInt($('#total-domains').text()),
			processed: parseInt($('#processed-domains').text()),
			found: parseInt($('#found-domains').text()),
			threatLevel: $('#threat-level').text()
		}
	};
	
	const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
	const url = URL.createObjectURL(blob);
	const a = document.createElement('a');
	a.href = url;
	a.download = `dnspermutator-scan-${Date.now()}.json`;
	a.click();
	URL.revokeObjectURL(url);
	
	addActivityItem('üìä Results exported successfully', 'success');
}

// Chart initialization
function initializeCharts() {
	// Initialize canvas context for timeline chart
	const canvas = document.getElementById('progressChart');
	if (canvas) {
		const ctx = canvas.getContext('2d');
		drawTimelineChart(ctx);
	}
}

function drawTimelineChart(ctx) {
	const width = ctx.canvas.width;
	const height = ctx.canvas.height;
	
	// Clear canvas
	ctx.clearRect(0, 0, width, height);
	
	// Draw background grid
	ctx.strokeStyle = 'rgba(102, 126, 234, 0.1)';
	ctx.lineWidth = 1;
	
	for (let i = 0; i < 10; i++) {
		const y = (height / 10) * i;
		ctx.beginPath();
		ctx.moveTo(0, y);
		ctx.lineTo(width, y);
		ctx.stroke();
	}
	
	// Draw chart data if available
	if (chartData.length > 1) {
		ctx.strokeStyle = '#667eea';
		ctx.lineWidth = 3;
		ctx.beginPath();
		
		chartData.forEach((point, index) => {
			const x = (width / (chartData.length - 1)) * index;
			const y = height - (point.percentage / 100 * height);
			
			if (index === 0) {
				ctx.moveTo(x, y);
			} else {
				ctx.lineTo(x, y);
			}
		});
		
		ctx.stroke();
		
		// Draw points
		ctx.fillStyle = '#667eea';
		chartData.forEach((point, index) => {
			const x = (width / (chartData.length - 1)) * index;
			const y = height - (point.percentage / 100 * height);
			
			ctx.beginPath();
			ctx.arc(x, y, 4, 0, 2 * Math.PI);
			ctx.fill();
		});
	}
}

// Update donut chart
function updateDonutChart(percentage) {
	const circumference = 2 * Math.PI * 70; // radius = 70
	const offset = circumference - (percentage / 100) * circumference;
	
	$('#donut-progress').css('stroke-dashoffset', offset);
	$('#completion-percentage').text(Math.round(percentage) + '%');
}

last_registered = 0;

// Generate sample domain permutations for visual feedback
function generateDomainPermutations(domain) {
    if (!domain) return [];
    
    const baseDomain = domain.replace(/^www\./, '').split('.')[0];
    const tld = domain.includes('.') ? domain.split('.').slice(1).join('.') : 'com';
    
    const permutations = [
        // Character omission
        ...Array.from({length: baseDomain.length}, (_, i) => 
            baseDomain.slice(0, i) + baseDomain.slice(i + 1) + '.' + tld
        ),
        // Character repetition
        ...Array.from({length: baseDomain.length}, (_, i) => 
            baseDomain.slice(0, i) + baseDomain[i] + baseDomain.slice(i) + '.' + tld
        ),
        // Character replacement (common typos)
        baseDomain.replace('o', '0') + '.' + tld,
        baseDomain.replace('i', '1') + '.' + tld,
        baseDomain.replace('e', '3') + '.' + tld,
        baseDomain.replace('a', '@') + '.' + tld,
        // Common substitutions
        baseDomain.replace('m', 'n') + '.' + tld,
        baseDomain.replace('n', 'm') + '.' + tld,
        baseDomain.replace('d', 'cl') + '.' + tld,
        baseDomain.replace('c', 'd') + '.' + tld,
        // Subdomain variations
        'www.' + domain,
        'm.' + domain,
        'mobile.' + domain,
        'secure.' + domain,
        // TLD variations
        baseDomain + '.net',
        baseDomain + '.org',
        baseDomain + '.info',
        baseDomain + '.biz',
        baseDomain + '.co',
        // Hyphenated versions
        baseDomain.split('').join('-') + '.' + tld,
        baseDomain.replace(/(.)/g, '$1-').slice(0, -1) + '.' + tld
    ];
    
    return permutations.slice(0, 100); // Limit to reasonable number
}

function shareResults() {
	navigator.clipboard.writeText(window.location.href.split('#')[0] + '#' + $('#sid').val());
	$('#status').html('<div class="message success">üìã Results URL copied to clipboard!</div>');
	setTimeout(() => {
		$('#status').html('');
	}, 3000);
}

function fetchDomains() {
	$.getJSON('/api/scans/' + $('#sid').val() + '/domains', function(data) {
		$('#data').empty();
		$('<tr>').html(
				'<th>PERMUTATION</th>' +
				'<th>IP ADDRESS</th>' +
				'<th>NAME SERVER</th>' +
				'<th>MAIL SERVER</th>'
			).appendTo('#data');
		$.each(data, function(i, item) {
			$.each(item, function(k, v) {
				if (v instanceof Array) {
					if (v[0] == '!ServFail') {
						data[i][k][0] = 'üö´'
					}
				}
			})
			fuzzer = item['fuzzer'] || ''
			permutation = item['domain'] || ''
			ipaddr = [
				(item['dns_a'] || [''])[0],
				(item['dns_aaaa'] || [''])[0]
			].filter(Boolean).join('</br>');
			dns_ns = (item['dns_ns'] || [''])[0];
			dns_mx = (item['dns_mx'] || [''])[0];
			geoip = item['geoip'] || '';
			$('<tr>').html(
				'<td><strong>' + permutation + '</strong> <a href="http://' + permutation + '" id="link" target="_blank">üîó</a><br><sup style="color: #667eea; font-weight: 500;">' + fuzzer + '</sup></td>' +
				'<td>' + ipaddr + '<br><sup style="color: #888;">' + geoip + '</sup></td>' +
				'<td>' + dns_ns + '</td>' +
				'<td>' + dns_mx + '</td>'
			).appendTo('#data');
		});
	});
}

function pollScan() {
    $.getJSON('/api/scans/' + $('#sid').val(), function(data) {
        // Calculate processing rate
        if (scanStartTime && data['complete'] > lastProcessedCount) {
            const elapsed = (Date.now() - scanStartTime) / 1000;
            processingRate = data['complete'] / elapsed;
        }
        lastProcessedCount = data['complete'];
        
        // Update dashboard metrics with animations
        animateCounter('#total-domains', data['total']);
        animateCounter('#processed-domains', data['complete']);
        animateCounter('#found-domains', data['registered']);
        
        // Update threat level
        const threatLevel = calculateThreatLevel(data['registered'], data['complete']);
        $('#threat-level').text(threatLevel);
        
        // Update metric trends
        $('#processing-rate').text(processingRate.toFixed(1) + ' domains/sec');
        const successRate = data['complete'] > 0 ? ((data['registered'] / data['complete']) * 100).toFixed(1) : 0;
        $('#success-rate').text(successRate + '% active');
        
        // Update threat description
        const threats = {
            'LOW': 'Minimal risk detected',
            'MEDIUM': 'Moderate risk level',
            'HIGH': 'Elevated threat level',
            'CRITICAL': 'High risk detected!'
        };
        $('#threat-desc').text(threats[threatLevel] || 'Analyzing...');
        
        // Update progress statistics (legacy)
        $('#processed-count').text(data['complete']);
        $('#found-count').text(data['registered']);
        $('#total-count').text(data['total']);
        
        // Update progress bar and charts
        const percentage = data['total'] > 0 ? (data['complete'] / data['total']) * 100 : 0;
        $('#progress').val(data['complete']/data['total']);
        $('#chart-fill').css('width', percentage + '%');
        $('#chart-percentage').text(Math.round(percentage) + '%');
        
        // Update donut chart
        updateDonutChart(percentage);
        
        // Update timeline chart data
        chartData.push({
            time: Date.now(),
            percentage: percentage,
            found: data['registered']
        });
        if (chartData.length > 50) chartData.shift(); // Keep last 50 points
        
        // Redraw timeline chart
        const canvas = document.getElementById('progressChart');
        if (canvas) {
            drawTimelineChart(canvas.getContext('2d'));
        }
        
        // Add activity feed updates
        if (data['registered'] > last_registered) {
            const newDomains = data['registered'] - last_registered;
            addActivityItem(`Found ${newDomains} new active domain${newDomains > 1 ? 's' : ''}`, 'success');
        }
        
        // Simulate showing current domain being scanned
        if (data['remaining'] > 0) {
            const currentIndex = data['complete'];
            const simulatedDomains = generateDomainPermutations($('#url').val());
            if (simulatedDomains[currentIndex]) {
                $('#current-scan').html('üîç Checking: <strong>' + simulatedDomains[currentIndex] + '</strong>');
                addActivityItem(`Scanning: ${simulatedDomains[currentIndex]}`);
            } else {
                $('#current-scan').html('üîç Scanning permutation <strong>#' + (currentIndex + 1) + '</strong>');
            }
        }
        
        $('#status').html('Processing domain permutations... (' + data['complete'] + ' of ' + data['total'] + ' completed)');
		
		// Show loading animation during scan
		if (data['remaining'] > 0) {
			$('#loading').show();
			$('#progress').show();
			$('#dashboard').show();
			
			// Add metric card animations
			$('.metric-card.processed').addClass('active');
			
			setTimeout(pollScan, 250);
		} else {
			$('#loading').hide();
			$('#current-scan').html('‚úÖ Scan completed!');
			$('#results-section').show();
			
			// Remove active animations
			$('.metric-card').removeClass('active');
			$('.metric-card.found').addClass('active');
			
			// Final activity update
			addActivityItem(`Scan completed! Found ${data['registered']} active domains`, 'success');
			
			sid = $('#sid').val()
			$('#status').html('<div class="message success">‚úÖ Scan completed! Found ' + data['registered'] + ' registered domains out of ' + data['complete'] + ' checked. <a href="#" onclick="shareResults()">üìã Share results</a> | Download: <a href="/api/scans/' + sid + '/csv">üìä CSV</a> <a href="/api/scans/' + sid + '/json">üìÑ JSON</a></div>');
			$('#scan').text('üîç Scan');
		}
		if (last_registered < data['registered']) {
			last_registered = data['registered']
			fetchDomains();
			updateDomainCards(); // Update the new card view
		}
    })
	.fail(function(){
		$('#loading').hide();
		$('#dashboard').hide();
		addActivityItem('Scan failed - connection error', 'error');
		$('#status').html('<div class="message error">‚ùå Oops! Something went wrong. Please try again.</div>');
	});
}

function actionScan() {
	if (!$('#url').val()) {
		$('#status').html('<div class="message error">‚ö†Ô∏è Please enter a domain name first</div>');
		$('#url').focus();
		return
	}

	if ($('#scan').text().includes('Scan')) {
		last_registered = 0;
		$('#scan').html('‚è≥ Starting...');
		$('#status').html('');
		$('#progress').val(0).show();
		$('#data').empty();
		
		// Reset dashboard
		scanStartTime = Date.now();
		lastProcessedCount = 0;
		processingRate = 0;
		activityFeedItems = [];
		discoveredDomains = [];
		chartData = [];
		
		// Reset loading display
		$('#processed-count').text('0');
		$('#found-count').text('0');
		$('#total-count').text('0');
		$('#chart-fill').css('width', '0%');
		$('#chart-percentage').text('0%');
		$('#current-scan').html('üöÄ Initializing scan...');
		
		// Initialize activity feed
		addActivityItem('üöÄ Scan initialized for ' + $('#url').val(), 'info');
		
		$.post({
			url: '/api/scans',
			data: JSON.stringify({'url': $('#url').val()}),
			contentType: 'application/json',
			success: function(data) {
				$('#sid').val(data['id']);
				$('#url').val(data['domain']);
				$('#scan').html('‚èπÔ∏è Stop');
				$('#loading').show();
				pollScan();
			},
			error: function(xhr, status, error) {
				$('#scan').html('üîç Scan');
				$('#loading').hide();
				$('#status').html('<div class="message error">‚ùå ' + (xhr.responseJSON && xhr.responseJSON['message'] || 'Failed to start scan. Please try again.') + '</div>');
			},
		});
	} else {
		$('#scan').html('‚è≥ Stopping...');
		$('#loading').hide();
		$.post({
			url: '/api/scans/' + $('#sid').val() + '/stop',
			contentType: 'application/json',
		})
		.always(function() {
			$('#scan').html('üîç Scan');
			$('#status').html('<div class="message">üõë Scan stopped</div>');
		});
	}
}

$('#scan').click(function() {
	actionScan();
});

$('#url').on('keypress',function(e) {
    if(e.which == 13) {
        actionScan();
    }
});

$('#history').click(function() {
    loadHistory();
});

// Close modal when clicking on X or outside the modal
$('.close').click(function() {
    $('#history-modal').fadeOut();
});

$(window).click(function(e) {
    if ($(e.target).is('#history-modal')) {
        $('#history-modal').fadeOut();
    }
});

// Enhanced domain cards functionality
function updateDomainCards() {
	$.getJSON('/api/scans/' + $('#sid').val() + '/domains', function(data) {
		discoveredDomains = data;
		renderDomainCards(data);
	});
}

function renderDomainCards(domains) {
	const container = $('#domain-cards-container');
	container.empty();
	
	domains.forEach((domain, index) => {
		const riskLevel = calculateDomainRisk(domain);
		const card = createDomainCard(domain, riskLevel);
		container.append(card);
		
		// Stagger the animation
		setTimeout(() => {
			card.addClass('new');
		}, index * 50);
	});
}

function createDomainCard(domain, riskLevel) {
	const permutation = domain['domain'] || '';
	const fuzzer = domain['fuzzer'] || '';
	const ipAddr = [(domain['dns_a'] || [''])[0], (domain['dns_aaaa'] || [''])[0]].filter(Boolean).join(', ');
	const dnsNs = (domain['dns_ns'] || [''])[0];
	const dnsMx = (domain['dns_mx'] || [''])[0];
	const geoip = domain['geoip'] || '';
	
	return $(`
		<div class="domain-card risk-${riskLevel}" data-domain="${permutation}">
			<div class="risk-indicator risk-${riskLevel}"></div>
			<div class="domain-header">
				<h4 class="domain-name">${permutation}</h4>
				<div class="domain-actions">
					<button class="action-btn" onclick="visitDomain('${permutation}')" title="Visit domain">üîó</button>
					<button class="action-btn" onclick="copyDomain('${permutation}')" title="Copy domain">üìã</button>
					<button class="action-btn" onclick="analyzeRisk('${permutation}')" title="Analyze risk">üõ°Ô∏è</button>
				</div>
			</div>
			<div class="domain-details">
				<div class="detail-item">
					<div class="detail-label">IP Address</div>
					<div class="detail-value">${ipAddr || 'Not resolved'}</div>
				</div>
				<div class="detail-item">
					<div class="detail-label">Location</div>
					<div class="detail-value">${geoip || 'Unknown'}</div>
				</div>
				<div class="detail-item">
					<div class="detail-label">Name Server</div>
					<div class="detail-value">${dnsNs || 'Not found'}</div>
				</div>
				<div class="detail-item">
					<div class="detail-label">Mail Server</div>
					<div class="detail-value">${dnsMx || 'Not found'}</div>
				</div>
			</div>
			<div class="fuzzer-tag">${fuzzer}</div>
		</div>
	`);
}

function calculateDomainRisk(domain) {
	let risk = 0;
	
	// Has IP address
	if (domain['dns_a'] && domain['dns_a'][0]) risk += 30;
	
	// Has mail server
	if (domain['dns_mx'] && domain['dns_mx'][0]) risk += 25;
	
	// Has name server
	if (domain['dns_ns'] && domain['dns_ns'][0]) risk += 20;
	
	// Similar to original (higher risk for typos)
	const fuzzer = domain['fuzzer'] || '';
	if (fuzzer.includes('typo') || fuzzer.includes('bitsquatting')) risk += 25;
	
	if (risk >= 70) return 'high';
	if (risk >= 40) return 'medium';
	return 'low';
}

// Interactive functions
function visitDomain(domain) {
	window.open('http://' + domain, '_blank');
	addActivityItem(`üîó Visited ${domain}`, 'info');
}

function copyDomain(domain) {
	navigator.clipboard.writeText(domain);
	addActivityItem(`üìã Copied ${domain} to clipboard`, 'success');
}

function analyzeRisk(domain) {
	// Simulate risk analysis
	const risks = [
		'Domain similarity analysis: High risk',
		'DNS configuration check: Active',
		'Threat intelligence: No known threats',
		'Certificate analysis: No SSL certificate'
	];
	
	const analysis = risks.join('\n');
	alert(`üõ°Ô∏è Risk Analysis for ${domain}:\n\n${analysis}`);
	addActivityItem(`üõ°Ô∏è Analyzed risk for ${domain}`, 'info');
}

function filterDomains() {
	const query = $('#search-filter').val().toLowerCase();
	$('.domain-card').each(function() {
		const domain = $(this).data('domain').toLowerCase();
		if (domain.includes(query)) {
			$(this).show();
		} else {
			$(this).hide();
		}
	});
}

function sortDomains() {
	const sortBy = $('#sort-select').val();
	const container = $('#domain-cards-container');
	const cards = $('.domain-card').toArray();
	
	cards.sort((a, b) => {
		switch(sortBy) {
			case 'name':
				return $(a).data('domain').localeCompare($(b).data('domain'));
			case 'risk':
				const riskOrder = {'high': 3, 'medium': 2, 'low': 1};
				const aRisk = riskOrder[$(a).attr('class').match(/risk-(\w+)/)?.[1]] || 0;
				const bRisk = riskOrder[$(b).attr('class').match(/risk-(\w+)/)?.[1]] || 0;
				return bRisk - aRisk;
			case 'similarity':
				// Sort by fuzzer type (more sophisticated similarity would require API data)
				return $(a).find('.fuzzer-tag').text().localeCompare($(b).find('.fuzzer-tag').text());
			default:
				return 0;
		}
	});
	
	container.empty().append(cards);
}

function toggleView() {
	const btn = $('#view-toggle');
	const cardsContainer = $('#domain-cards-container');
	const table = $('#data');
	
	if (btn.text().includes('List')) {
		btn.html('üìã Card View');
		cardsContainer.hide();
		table.show();
	} else {
		btn.html('üìã List View');
		cardsContainer.show();
		table.hide();
	}
}

function toggleFilters() {
	$('.results-controls').slideToggle();
}

// Functions for the PostgreSQL history feature
function loadHistory() {
	$('#history-list').html('<p>Loading history...</p>');
	$('#history-modal').fadeIn();
	
	$.ajax({
		url: '/api/history',
		type: 'GET',
		success: function(data) {
			if (data.length > 0) {
				let html = '';
				data.forEach(function(scan) {
					const date = new Date(scan.timestamp * 1000);
					const formattedDate = date.toLocaleString();
					
					html += `
						<div class="history-item" data-scan-id="${scan.id}">
							<div class="history-domain">${scan.domain}</div>
							<div class="history-date">${formattedDate}</div>
							<div class="history-stats">
								<div class="history-stat">Total: ${scan.total}</div>
								<div class="history-stat">Found: ${scan.registered}</div>
								<div class="history-stat">Success: ${Math.round((scan.registered / scan.total) * 100)}%</div>
							</div>
						</div>
					`;
				});
				$('#history-list').html(html);
				
				// Add click event to history items
				$('.history-item').on('click', function() {
					const scanId = $(this).data('scan-id');
					loadHistoricalScan(scanId);
				});
			} else {
				$('#history-list').html('<p>No scan history available</p>');
			}
		},
		error: function() {
			$('#history-list').html('<p>Error loading history</p>');
		}
	});
}

function loadHistoricalScan(scanId) {
	$('#history-modal').fadeOut();
	$('#loading').slideDown();
	
	$.ajax({
		url: '/api/history/' + scanId,
		type: 'GET',
		success: function(data) {
			// Clear current scan data
			$('#sid').val('');
			$('#data').html('');
			$('#domain-cards-container').html('');
			
			$('#loading').slideUp();
			
			if (data.domains && data.domains.length > 0) {
				let tableRows = '';
				let cardsHtml = '';
				
				data.domains.forEach(function(domain) {
					let fuzzer = domain.fuzzer || '';
					let dns_a = domain.dns_a && domain.dns_a.length > 0 ? domain.dns_a.join(', ') : '';
					let dns_mx = domain.dns_mx && domain.dns_mx.length > 0 ? domain.dns_mx.map(r => r[1]).join(', ') : '';
					let dns_ns = domain.dns_ns && domain.dns_ns.length > 0 ? domain.dns_ns.join(', ') : '';
					let geoip = domain.geoip ? `${domain.geoip.country_name} (${domain.geoip.country_code})` : '';
					
					tableRows += `<tr>
						<td>${domain.domain}</td>
						<td>${fuzzer}</td>
						<td>${dns_a}</td>
						<td>${dns_mx}</td>
						<td>${dns_ns}</td>
						<td>${geoip}</td>
					</tr>`;
					
					// Determine risk level based on fuzzer type
					let riskClass = 'risk-low';
					if (fuzzer.includes('homoglyph') || fuzzer.includes('bitsquatting')) {
						riskClass = 'risk-high';
					} else if (fuzzer.includes('hyphenation') || fuzzer.includes('addition')) {
						riskClass = 'risk-medium';
					}
					
					cardsHtml += `
						<div class="domain-card ${riskClass}" data-domain="${domain.domain}">
							<div class="domain-header">
								<h3 class="domain-title">${domain.domain}</h3>
								<span class="fuzzer-tag">${fuzzer}</span>
							</div>
							<div class="domain-content">
								${dns_a ? `<div class="domain-detail"><span>IP:</span> ${dns_a}</div>` : ''}
								${dns_mx ? `<div class="domain-detail"><span>MX:</span> ${dns_mx}</div>` : ''}
								${dns_ns ? `<div class="domain-detail"><span>NS:</span> ${dns_ns}</div>` : ''}
								${geoip ? `<div class="domain-detail"><span>Location:</span> ${geoip}</div>` : ''}
							</div>
							<div class="domain-actions">
								<button onclick="copyDomain('${domain.domain}')" class="action-btn copy-btn">üìã Copy</button>
								<button onclick="analyzeRisk('${domain.domain}')" class="action-btn analyze-btn">üîç Analyze</button>
							</div>
						</div>
					`;
				});
				
				$('#data').html(`
					<thead>
						<tr>
							<th>Domain</th>
							<th>Fuzzer</th>
							<th>IP</th>
							<th>MX</th>
							<th>NS</th>
							<th>GeoIP</th>
						</tr>
					</thead>
					<tbody>${tableRows}</tbody>
				`);
				
				$('#domain-cards-container').html(cardsHtml);
				
				// Set current domain and header
				$('#current-scan').text(`${data.domain} (Historical scan)`);
				
				$('#results').slideDown();
				addActivityItem(`üìú Loaded historical scan for ${data.domain}`, 'info');
				
			} else {
				$('#data').html('<tr><td colspan="6">No data available for this scan</td></tr>');
				$('#domain-cards-container').html('<p>No data available for this scan</p>');
				addActivityItem('‚ùå No data found for historical scan', 'error');
			}
		},
		error: function() {
			$('#loading').slideUp();
			showMessage('‚ùå Error loading historical scan', 'error');
		}
	});
}
</script>
</html>



